<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script type="module" src="js/save.js"></script>
    <title>Habits Tracker</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f8f9fa;
            color: #333;
            margin: 0;
            padding: 0;
        }
        .container {
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
            border-radius: 10px;
            background-color: #ffffff;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }
        h1, h2 {
            text-align: center;
        }
        input[type="text"],
        input[type="number"],
        select {
            width: calc(100% - 22px);
            padding: 10px;
            border-radius: 10px;
            border: 1px solid #ccc;
            margin-bottom: 10px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        input[type="checkbox"] {
            margin-right: 5px;
        }
        button {
            padding: 10px 15px;
            border: none;
            border-radius: 20px;
            background-color: #007bff;
            color: white;
            cursor: pointer;
            transition: background-color 0.3s;
            margin-top: 10px;
            width: 100%;
        }
        button:hover {
            background-color: #0056b3;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        th {
            background-color: #f1f1f1;
        }
        .oval-btn {
            background-color: #28a745;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 20px;
            cursor: pointer;
        }
        .oval-btn:hover {
            background-color: #218838;
        }
        #habit-summary {
            margin-top: 20px;
            padding: 10px;
            border-radius: 10px;
            background-color: #f1f1f1;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        .checkpoint {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Habit Tracker</h1>
        <div class="habit-form">
            <input type="text" id="habit-name" placeholder="Habit Name" required>
            <select id="habit-type">
                <option value="positive">Positive</option>
                <option value="negative">Negative</option>
            </select>
            <input type="number" id="habit-target" placeholder="Target Value (Times)" required>
            <select id="habit-frequency">
                <option value="daily">Daily</option>
                <option value="weekly">Weekly</option>
                <option value="monthly">Monthly</option>
            </select>
            <input type="number" id="habit-times" placeholder="How many times?" required>
            <input type="text" id="habit-start-date" placeholder="Start Date" readonly>
            <button id="add-habit" class="oval-btn">Add Habit</button>
        </div>
        <table id="habit-list">
            <thead>
                <tr>
                    <th>Habit</th>
                    <th>Type</th>
                    <th>Target Value</th>
                    <th>Progress (%)</th>
                    <th>Status</th>
                    <th>Edit</th>
                    <th>Delete</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
        <div id="habit-summary"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script>
        const habits = {}; // Object to store habits

        // Initialize Flatpickr
        flatpickr("#habit-start-date", {
            dateFormat: "Y-m-d",
            static: true,
        });

        // Function to add a habit
        document.getElementById("add-habit").addEventListener("click", function() {
            const habitName = document.getElementById("habit-name").value;
            const habitType = document.getElementById("habit-type").value;
            const targetTimes = parseInt(document.getElementById("habit-target").value);
            const frequency = document.getElementById("habit-frequency").value;
            const timesPerPeriod = parseInt(document.getElementById("habit-times").value);

            // Validate input data
            if (habitName && !isNaN(targetTimes) && targetTimes > 0 && !isNaN(timesPerPeriod) && timesPerPeriod > 0) {
                if (!habits[habitName]) {
                    habits[habitName] = {
                        type: habitType,
                        targetTimes,
                        frequency,
                        timesPerPeriod,
                        completed: 0,
                        missed: 0,
                        progress: 0,
                        checkpoints: createCheckpoints(frequency, timesPerPeriod),
                    };
                }

                updateHabitTable(); // Update habit table
                clearInputs(); // Clear input fields
            } else {
                alert("Please enter valid habit data.");
            }
        });

        // Create checkpoints based on frequency
        function createCheckpoints(frequency, timesPerPeriod) {
            const checkpoints = [];
            const today = new Date();

            if (frequency === "daily") {
                for (let i = 0; i < timesPerPeriod; i++) {
                    checkpoints.push({
                        date: new Date(today.getFullYear(), today.getMonth(), today.getDate() + i).toISOString().split('T')[0],
                        completed: false,
                    });
                }
            } else if (frequency === "weekly") {
                const daysOfWeek = ["Mon", "Tue", "Wed", "Thu", "Fri", "Sat", "Sun"];
                let daysCount = 0;
                for (let i = 0; i < 7; i++) {
                    if (daysCount < timesPerPeriod) {
                        checkpoints.push({
                            date: new Date(today.getFullYear(), today.getMonth(), today.getDate() + i).toISOString().split('T')[0],
                            completed: false,
                        });
                        daysCount++;
                    }
                }
            } else if (frequency === "monthly") {
                for (let i = 0; i < timesPerPeriod; i++) {
                    checkpoints.push({
                        date: new Date(today.getFullYear(), today.getMonth() + i, today.getDate()).toISOString().split('T')[0],
                        completed: false,
                    });
                }
            }

            return checkpoints;
        }

        // Update the habit table
        function updateHabitTable() {
            const habitList = document.getElementById("habit-list").getElementsByTagName('tbody')[0];
            habitList.innerHTML = ""; // Clear current list

            for (const [name, details] of Object.entries(habits)) {
                const row = document.createElement("tr");

                row.innerHTML = `
                    <td>${name}</td>
                    <td>${details.type === "positive" ? "Positive" : "Negative"}</td>
                    <td>${details.targetTimes} ${details.frequency}</td>
                    <td>${details.progress}%</td>
                `;

                // Status column with checkboxes for checkpoints
                const statusCell = document.createElement("td");
                details.checkpoints.forEach((checkpoint, index) => {
                    const checkbox = document.createElement("input");
                    checkbox.type = "checkbox";
                    checkbox.checked = checkpoint.completed;
                    checkbox.onchange = () => {
                        checkpoint.completed = checkbox.checked;
                        updateProgress(details);
                        updateHabitTable();
                    };
                    statusCell.appendChild(checkbox);
                    statusCell.appendChild(document.createTextNode(` ${checkpoint.date}`));
                });
                row.appendChild(statusCell);

                // Edit button
                const editCell = document.createElement("td");
                const editButton = document.createElement("button");
                editButton.textContent = "Edit";
                editButton.className = "oval-btn";
                editButton.onclick = () => editHabit(name);
                editCell.appendChild(editButton);
                row.appendChild(editCell);

                // Delete button
                const deleteCell = document.createElement("td");
                const deleteButton = document.createElement("button");
                deleteButton.textContent = "Delete";
                deleteButton.className = "oval-btn";
                deleteButton.onclick = () => deleteHabit(name);
                deleteCell.appendChild(deleteButton);
                row.appendChild(deleteCell);

                habitList.appendChild(row);
            }

            updateSummary(); // Update summary
        }

        // Update progress based on checkpoints
        function updateProgress(habit) {
            let completedCount = habit.checkpoints.filter(checkpoint => checkpoint.completed).length;
            habit.progress = (completedCount / habit.checkpoints.length) * 100;
        }

        // Update the summary
        function updateSummary() {
            let totalHabits = Object.keys(habits).length;
            let completedHabits = Object.values(habits).filter(habit => habit.progress === 100).length;
            let progressSummary = `<strong>Summary:</strong> ${completedHabits} out of ${totalHabits} habits are fully completed.`;

            document.getElementById("habit-summary").innerHTML = progressSummary;
        }

        // Edit habit function
        function editHabit(habitName) {
            const habit = habits[habitName];
            document.getElementById("habit-name").value = habitName;
            document.getElementById("habit-type").value = habit.type;
            document.getElementById("habit-target").value = habit.targetTimes;
            document.getElementById("habit-frequency").value = habit.frequency;
            document.getElementById("habit-times").value = habit.timesPerPeriod;
            document.getElementById("habit-start-date").value = habit.checkpoints[0].date;
        }

        // Delete habit function
        function deleteHabit(habitName) {
            delete habits[habitName];
            updateHabitTable(); // Update table after deletion
        }

        // Clear input fields
        function clearInputs() {
            document.getElementById("habit-name").value = '';
            document.getElementById("habit-target").value = '';
            document.getElementById("habit-times").value = '';
            document.getElementById("habit-start-date").value = '';
        }
    </script>
</body>
</html>

