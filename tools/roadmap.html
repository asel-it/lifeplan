<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Roadmap</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Exo+2:wght@300;400;600&family=Orbitron&display=swap" rel="stylesheet">
    <script type="module" src="js/save.js"></script>
    <style>
        /* Основной стиль */
        * {
            font-family: 'Orbitron', sans-serif;
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html, body {
            height: 100%;
            margin: 0;
            overflow-y: auto;
            background-color: #f4f4f4;
            color: #333;
        }

        .roadmapTitle {
            font-size: 3.5em;
            margin-top: 20px;
            text-align: center;
            color: #007777;
            margin-bottom: 20px;
        }

        /* Контейнер */
        .container {
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: stretch;
            width: 90%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Поля ввода */
        .input-field {
            width: 100%;
            padding: 10px;
            border: 1px solid #007777;
            border-radius: 10px;
            margin-bottom: 10px;
        }

        /* Стили для выпадающих полей */
        .step-inputs {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .step-select {
            margin-left: 10px;
            padding: 10px;
            border: 1px solid #007777;
            border-radius: 10px;
            width: auto;
        }

        /* Временная шкала */
        .timeline-content {
            position: relative;
            height: 50px;
            background: #e0e7e8;
            margin-top: 20px;
            border-radius: 10px;
        }

        /* Индикаторы задач и ключевых точек */
        .task-indicator, .milestone-indicator {
            position: absolute;
            bottom: 0;
            width: 10px;
            height: 20px;
            border-radius: 5px;
        }

        /* Метки задач и ключевых точек */
        .task-label, .milestone-label {
            position: absolute;
            bottom: 25px;
            font-size: 12px;
            transform: translateX(-50%);
        }

        /* Стили для карточек задач */
        .card {
            padding: 10px;
            border: 1px solid #ccc;
            margin: 5px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-radius: 10px;
            background-color: #ffffff;
        }

        /* Цвет для ключевых точек */
        .milestone {
            background-color: #ffeb3b;
        }

        /* Кнопка */
        .button {
            padding: 10px 20px;
            background-color: #007777;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1em;
            margin: 10px 0;
            transition: background-color 0.3s ease;
            width: 100%;
        }

        .button:hover {
            background-color: #005e5e;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="roadmapTitle">Roadmap</h1>

        <div class="project-name-input">
            <input type="text" id="project-name" class="input-field" placeholder="Enter Project Name" required>
        </div>

        <div class="date-selection">
            <input type="text" id="start-date" class="input-field" placeholder="Set a start date" required>
            <input type="text" id="end-date" class="input-field" placeholder="Set a deadline" required>
        </div>

        <div class="step-selection">
            <div class="step-inputs">
                <label for="step-size">Set a step:</label>
                <select id="step-size" class="step-select">
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                    <option value="6">6</option>
                    <option value="7">7</option>
                </select>
                <label for="step-unit" style="margin-left: 20px;">Unit:</label>
                <select id="step-unit" class="step-select">
                    <option value="day">Day</option>
                    <option value="week">Week</option>
                    <option value="month">Month</option>
                    <option value="year">Year</option>
                </select>
            </div>
            <button id="set-timeline-button" class="button">Set up timeline</button>
        </div>

        <div class="task-input">
            <input type="text" id="task-input" class="input-field" placeholder="Enter Task" required>
            <input type="text" id="task-date" class="input-field" placeholder="Set Task Date" required>
            <button id="add-task-button" class="button">Add Task</button>
        </div>

        <div class="milestone-input">
            <input type="text" id="milestone-input" class="input-field" placeholder="Enter Milestone" required>
            <input type="text" id="milestone-date" class="input-field" placeholder="Set Milestone Date" required>
            <button id="add-milestone-button" class="button">Add Milestone</button>
        </div>

        <div id="timeline">
            <div class="timeline-content"></div>
        </div>

        <div class="task-container"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script>
        // Получаем элементы из DOM
        const addTaskButton = document.getElementById('add-task-button');
        const addMilestoneButton = document.getElementById('add-milestone-button');
        const taskInput = document.getElementById('task-input');
        const milestoneInput = document.getElementById('milestone-input');
        const taskContainer = document.querySelector('.task-container');
        const timelineContent = document.querySelector('.timeline-content');
        const startDateInput = document.getElementById('start-date');
        const endDateInput = document.getElementById('end-date');
        const setTimelineButton = document.getElementById('set-timeline-button');
        const stepSizeInput = document.getElementById('step-size');
        const stepUnitInput = document.getElementById('step-unit');
        const taskDateInput = document.getElementById('task-date');
        const milestoneDateInput = document.getElementById('milestone-date');

        let taskCounter = 0; // Счетчик задач
        let milestoneCounter = 0; // Счетчик ключевых точек
        const taskColor = '#33FF57'; // Зеленый цвет для задач
        const milestoneColor = '#FF5733'; // Красный цвет для ключевых точек

        // Инициализируем flatpickr для выбора дат
        flatpickr(startDateInput, {
            dateFormat: "Y-m-d",
            onChange: function (selectedDates) {
                if (selectedDates.length > 0) {
                    startDateInput.value = selectedDates[0].toISOString().split('T')[0];
                }
            }
        });

        flatpickr(endDateInput, {
            dateFormat: "Y-m-d",
            onChange: function (selectedDates) {
                if (selectedDates.length > 0) {
                    endDateInput.value = selectedDates[0].toISOString().split('T')[0];
                }
            }
        });

        // Функция для настройки временной шкалы
        setTimelineButton.addEventListener('click', () => {
            const startDate = new Date(startDateInput.value);
            const endDate = new Date(endDateInput.value);

            // Очистить предыдущие метки
            timelineContent.innerHTML = '';

            // Устанавливаем шаг и отображаем метки на временной шкале
            const stepSize = parseInt(stepSizeInput.value);
            const stepUnit = stepUnitInput.value;
            let currentDate = new Date(startDate);

            while (currentDate <= endDate) {
                addDateIndicator(currentDate, currentDate.toLocaleDateString(), 'step');

                if (stepUnit === 'day') {
                    currentDate.setDate(currentDate.getDate() + stepSize);
                } else if (stepUnit === 'week') {
                    currentDate.setDate(currentDate.getDate() + stepSize * 7);
                } else if (stepUnit === 'month') {
                    currentDate.setMonth(currentDate.getMonth() + stepSize);
                } else if (stepUnit === 'year') {
                    currentDate.setFullYear(currentDate.getFullYear() + stepSize);
                }
            }
        });

        // Функция для добавления меток с датами на временную шкалу
        function addDateIndicator(date, label, type) {
            const indicator = document.createElement('div');
            indicator.classList.add(type === 'step' ? 'task-indicator' : 'milestone-indicator');
            const labelElement = document.createElement('div');
            labelElement.classList.add(type === 'step' ? 'task-label' : 'milestone-label');
            labelElement.innerHTML = label;

            const offset = calculateOffset(date);
            indicator.style.left = `${offset}%`;

            timelineContent.appendChild(indicator);
            timelineContent.appendChild(labelElement);
        }

        // Функция для расчета смещения в зависимости от даты
        function calculateOffset(date) {
            const startDate = new Date(startDateInput.value);
            const endDate = new Date(endDateInput.value);
            const totalDuration = endDate - startDate;
            const elapsedTime = date - startDate;
            return (elapsedTime / totalDuration) * 100;
        }

        // Обработчик для добавления задач
        addTaskButton.addEventListener('click', () => {
            const taskName = taskInput.value;
            const taskDate = taskDateInput.value;

            if (taskName && taskDate) {
                const taskDateObject = new Date(taskDate);
                addDateIndicator(taskDateObject, taskName, 'task');

                const taskCard = document.createElement('div');
                taskCard.classList.add('card');
                taskCard.innerHTML = `<span>${taskName}</span><span>${taskDate}</span>`;
                taskContainer.appendChild(taskCard);

                taskCounter++;
                taskInput.value = '';
                taskDateInput.value = '';
            }
        });

        // Обработчик для добавления ключевых точек
        addMilestoneButton.addEventListener('click', () => {
            const milestoneName = milestoneInput.value;
            const milestoneDate = milestoneDateInput.value;

            if (milestoneName && milestoneDate) {
                const milestoneDateObject = new Date(milestoneDate);
                addDateIndicator(milestoneDateObject, milestoneName, 'milestone');

                const milestoneCard = document.createElement('div');
                milestoneCard.classList.add('card', 'milestone');
                milestoneCard.innerHTML = `<span>${milestoneName}</span><span>${milestoneDate}</span>`;
                taskContainer.appendChild(milestoneCard);

                milestoneCounter++;
                milestoneInput.value = '';
                milestoneDateInput.value = '';
            }
        });
    </script>
</body>
</html>


